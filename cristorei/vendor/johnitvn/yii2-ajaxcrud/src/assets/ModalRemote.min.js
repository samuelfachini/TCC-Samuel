function ModalRemote(modalId){function beforeRemoteRequest(){this.show(),this.displayLoading()}function errorRemoteResponse(t){this.setTitle(t.status+t.statusText),this.setContent(t.responseText),this.addFooterButton("Close","button","btn btn-default",function(t,e){this.hide()})}function successRemoteResponse(response){if(void 0!==response.forceReload&&response.forceReload&&("true"==response.forceReload?$.pjax.reload({container:"#crud-datatable-pjax"}):$.pjax.reload({container:response.forceReload})),this.attribute&&response.dataId){var x=$("#"+this.attribute);x.prepend('<option value="'+response.dataId+'">'+response.dataText+"</option>"),x.val(response.dataId).trigger("change")}return this.aftersave&&response.dataId&&eval(this.aftersave),void 0!==response.forceClose&&response.forceClose?void this.hide():(void 0!==response.size&&this.setSize(response.size),void 0!==response.title&&this.setTitle(response.title),void 0!==response.content&&this.setContent(response.content),void 0!==response.footer&&this.setFooter(response.footer),void(void 0!==$(this.content).find("form")[0]&&this.setupFormSubmit($(this.content).find("form")[0],$(this.footer).find('[type="submit"]')[0])))}this.defaults={okLabel:"OK",executeLabel:"Executar",cancelLabel:"Cancelar",loadingTitle:"Carregando"},this.modal=$(modalId),this.dialog=$(modalId).find(".modal-dialog"),this.header=$(modalId).find(".modal-header"),this.content=$(modalId).find(".modal-body"),this.footer=$(modalId).find(".modal-footer"),this.loadingContent='<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>',this.attribute=null,this.aftersave=null,this.show=function(){this.clear(),$(this.modal).modal("show")},this.hide=function(){$(this.modal).modal("hide")},this.toggle=function(){$(this.modal).modal("toggle")},this.clear=function(){$(this.modal).find(".modal-title").remove(),$(this.content).html(""),$(this.footer).html("")},this.setSize=function(t){$(this.dialog).removeClass("modal-lg"),$(this.dialog).removeClass("modal-sm"),"large"==t?$(this.dialog).addClass("modal-lg"):"small"==t?$(this.dialog).addClass("modal-sm"):"normal"!==t&&console.warn("Undefined size "+t)},this.setHeader=function(t){$(this.header).html(t)},this.setContent=function(t){$(this.content).html(t)},this.setFooter=function(t){$(this.footer).html(t)},this.setTitle=function(t){$(this.header).find("h4.modal-title").remove(),$(this.header).append('<h4 class="modal-title">'+t+"</h4>")},this.hidenCloseButton=function(){$(this.header).find("button.close").hide()},this.showCloseButton=function(){$(this.header).find("button.close").show()},this.displayLoading=function(){this.setContent(this.loadingContent),this.setTitle(this.defaults.loadingTitle)},this.addFooterButton=function(t,e,o,s){buttonElm=document.createElement("button"),buttonElm.setAttribute("type",null===e?"button":e),buttonElm.setAttribute("class",null===o?"btn btn-primary":o),buttonElm.innerHTML=t;var a=this;$(this.footer).append(buttonElm),null!==s&&$(buttonElm).click(function(t){s.call(a,this,t)})},this.doRemote=function(t,e,o){var s=this;$.ajax({url:t,method:e,data:o,beforeSend:function(){beforeRemoteRequest.call(s)},error:function(t){errorRemoteResponse.call(s,t)},success:function(t){successRemoteResponse.call(s,t)},contentType:!1,cache:!1,processData:!1})},this.setupFormSubmit=function(t,e){if(void 0===e)console.warn("Modal has form but does not have a submit button");else{var o=this;$(e).click(function(e){var s;s=window.FormData?new FormData($(t)[0]):$(t).serializeArray(),o.doRemote($(t).attr("action"),$(t).hasAttr("method")?$(t).attr("method"):"GET",s)}),$(t).on("submit",function(t){t.preventDefault(),e.click()})}},this.confirmModal=function(t,e,o,s,a,i,n,r){this.show(),this.setSize(a),void 0!==t&&this.setTitle(t),this.setContent('<form id="ModalRemoteConfirmForm">'+e);var d=this;this.addFooterButton(void 0===o?this.defaults.okLabel:o,"submit","btn btn-primary",function(t){var e;window.FormData?(e=new FormData($("#ModalRemoteConfirmForm")[0]),"undefined"!=typeof r&&r&&e.append("pks",r.join())):(e=$("#ModalRemoteConfirmForm"),"undefined"!=typeof r&&r&&(e.pks=r),e=e.serializeArray()),d.doRemote(i,n,e)}),this.addFooterButton(void 0===s?this.defaults.cancelLabel:s,"button","btn btn-default pull-left",function(t){this.hide()})},this.open=function(t,e){var o=$(t).attr("href");if($(t).hasAttr("attribute")&&(this.attribute=$(t).attr("attribute"),$(t).hasAttr("type")&&"update"==$(t).attr("type"))){var s="#"+$(t).attr("attribute");o+="&id="+$(s).val()}$(t).hasAttr("aftersave")&&(this.aftersave=$(t).attr("aftersave")),$(t).hasAttr("data-confirm-title")||$(t).hasAttr("data-confirm-message")?this.confirmModal($(t).attr("data-confirm-title"),$(t).attr("data-confirm-message"),$(t).attr("data-confirm-ok"),$(t).attr("data-confirm-cancel"),$(t).hasAttr("data-modal-size")?$(t).attr("data-modal-size"):"normal",$(t).hasAttr("href")?o:$(t).attr("data-url"),$(t).hasAttr("data-request-method")?$(t).attr("data-request-method"):"GET",e):this.doRemote($(t).hasAttr("href")?o:$(t).attr("data-url"),$(t).hasAttr("data-request-method")?$(t).attr("data-request-method"):"GET",e)}}!function(t){t.fn.hasAttr=function(t){return void 0!==this.attr(t)}}(jQuery);
